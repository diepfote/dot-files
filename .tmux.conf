
# SET TMUX VERSION NUMBER for version based if statements
run-shell 'tmux setenv -g TMUX_VERSION $(tmux -V | \
              sed -En "s/^tmux[^0-9]*([.0-9]+).*/\1/p")'


# --- sensible tmux

# set -g prefix C-a

# address vim mode switching delay (http://superuser.com/a/252717/65504)
set -s escape-time 0

# tmux messages are displayed for 4 seconds
set -g display-time 4000

# refresh 'status-left' and 'status-right' every x seconds
set -g status-interval 300

# super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# ----

# ensure there is no gap in between window numbers
set-option -g renumber-windows on

#set -g default-terminal "xterm-256color"
#set -g default-terminal "tmux-256color"
set -g default-terminal "screen-256color"
#set -g default-terminal "xterm-kitty"

# tmux must be told that the terminal outside supports RGB colour.
set -as terminal-overrides ",gnome*:RGB"

# set status bar color  | to display the 256 color-palette run: ~/Documents/scripts/256-color-palette.sh
set -g status-bg colour240
set -g status-fg white
set -g status-right-length 250


set -g status-right '#{prefix_highlight} #(~/Documents/golang/tools/tmux-statusbar-right/tmux_info.sh)'
if-shell -b '[ "$(uname)" = Linux ]' \
  "set -g status-right '#{prefix_highlight} # CPU: #{cpu_percentage} | #(~/Documents/golang/tools/tmux-statusbar-right/tmux_info.sh)'";


# pane border format
set -g pane-border-status bottom
set -g pane-border-style "bg=white fg=black"
set -g pane-active-border-style "bg=default fg=magenta"
set -g pane-border-format " #{pane_id} | #(~/Documents/golang/tools/tmux-pane-border/tmux-pane-border #{pane_current_path}) | #{pane_current_command}"


set -g history-limit 100000


if-shell -b '[ "$(echo "$TMUX_VERSION < 3" | bc)" = 1 ]' " \
    set -g focus-events on "


if-shell -b '[ "$(echo "$TMUX_VERSION >= 2.1" | bc)" = 1 ]' " \
    set -g mouse on "
if-shell -b '[ "$(echo "$TMUX_VERSION < 2.1" | bc)" = 1 ]' " \
    set -g mode-mouse on "

# --------------
# alter tmux copy-paste behavior

if-shell -b '[ "$(echo "$TMUX_VERSION >= 2.4" | bc)" = 1 ]' " \
  unbind-key -T copy-mode-vi v; \
  set -g status-keys vi; \
  set -g mode-keys vi; \
  bind-key -T copy-mode-vi v send-keys -X begin-selection; \
  bind-key -T copy-mode-vi -n C-v send-keys -X rectangle-toggle; \
  set -g set-clipboard on ; \
  bind -T copy-mode-vi y send-keys -X copy-pipe 'xclip -selection clipboard' "
  # bind-key -T copy-mode-vi y send-keys -X copy-selection  #  on servers

if-shell -b '[ "$(echo "$TMUX_VERSION < 2.4" | bc)" = 1 ]' " \
  unbind-key -t vi-copy v; \
  setw -g mode-keys vi; \
  bind-key -t vi-copy 'v' begin-selection; \
  bind-key -t vi-copy 'C-v' rectangle-toggle; \
  bind-key -t vi-copy 'y' copy-selection; \
  bind P paste-buffer "

# --------------


# from http://endot.org/2011/12/06/my-tmux-configuration/
## vim-like pane resizing
bind -r C-left resize-pane  -L\; refresh-client -S
bind -r C-right resize-pane -R\; refresh-client -S
bind -r C-up resize-pane    -U\; refresh-client -S
bind -r C-down resize-pane  -D\; refresh-client -S

bind -r C-h select-pane -L\; refresh-client -S
bind -r C-l select-pane -R\; refresh-client -S
bind -r C-k select-pane -U\; refresh-client -S
bind -r C-j select-pane -D\; refresh-client -S
bind -r 'C-\' select-pane -l\;  # return to previous view (e.g. after :VtrFocusRunner)

# ------------------------------
# new pane or window -> cd to current pane dir
bind '"' split-window -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"
# ------------------------------



## tmux-copycat settings - tmux-copycat stored searches
#====================

# maybe add IPv6 support
set -g @copycat_search_C-i '[[:digit:]]{1,3}\.[[:digit:]]{1,3}\.[[:digit:]]{1,3}\.[[:digit:]]{1,3}' # custom keyboard shortcut for ip search

set -g @copycat_search_h '\b([0-9a-f]{7,40}|[[:alnum:]]{52}|[0-9a-f]{64}|[0-9a-f]{56}|[0-9a-zA-Z+]{68})\b' # custom hash search and keyboard shortcut

set -g @copycat_search_k '[A-Za-z0-9-]+-[a-f0-9]{10}-[a-z0-9]{5}|[A-Za-z0-9-]+-[a-z0-9]{5}' #  search for kubernetes objects

set -g @copycat_search_a '0x[A-Fa-f0-9]{8}|0x[A-Fa-f0-9]{16}|[A-Fa-f0-9]{8}|[A-Fa-f0-9]{16}' # 32 or 64 bit adresses

set -g @copycat_search_i '[[:alnum:]]{12}\\s' # search for docker container id

set -g @copycat_search_C-a '^.+$' # any non-empty line

#====================


## tmux-continuum settings
#=========================

set -g @continuum-restore 'on'

#========================

## tmux-resurrect settings
#=========================

# does NOT work for FIREJAILED PROCESSES
set -g @resurrect-processes 'n nnn "git l -p" "git l" "git show --stat" "git show" "git diff --word-diff" python'
# set -g @resurrect-strategy-nvim 'session'  # fix restart cds into directory of previously opened file
# set -g @resurrect-strategy-vim 'session'

#========================



## INSTALLING PLUGINS
## 1) tmux source ~/.tmux.conf
## 2) Press prefix + I or run $TMUX_PLUGIN_MANAGER_PATH/tpm/scripts/install_plugins.sh to fetch plugins and source them.

# List of plugins
set -g @plugin 'tmux-plugins/tpm'

set -g @plugin 'tmux-plugins/tmux-logging'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-open'

set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-resurrect'

set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-cpu'

## examples
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'git@github.com/user/plugin'
# set -g @plugin 'git@bitbucket.com/user/plugin'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
# running plugins#
run-shell ~/.tmux/plugins/tmux-copycat/copycat.tmux
run-shell ~/.tmux/plugins/tmux-copycat/open.tmux
run-shell ~/.tmux/plugins/tmux-logging/logging.tmux
run-shell ~/.tmux/plugins/tmux-continuum/continuum.tmux
run-shell ~/.tmux/plugins/tmux-prefix-highlight/prefix_highlight.tmux
run-shell ~/.tmux/plugins/tmux-cpu/cpu.tmux

