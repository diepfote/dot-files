# --- sensible tmux

# address vim mode switching delay (http://superuser.com/a/252717/65504)
set -s escape-time 0

# tmux messages are displayed for 4 seconds
set -g display-time 4000

# refresh 'status-left' and 'status-right' every x seconds
set -g status-interval 300

## emacs key bindings in tmux command prompt (prefix + :) are better than
## vi keys, even for vim users
#set -g status-keys emacs

# focus events enabled for terminals that support them
set -g focus-events on

# super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# ----


#set -g default-terminal "xterm-256color"
#set -g default-terminal "tmux-256color"

set -g default-terminal "screen-256color"
#set -g default-terminal "xterm-kitty"

# tmux must be told that the terminal outside supports RGB colour.
set -as terminal-overrides ",gnome*:RGB"

# set status bar color  | to display the 256 color-palette run: ~/Documents/scripts/256-color-palette.sh
set -g status-bg colour240
set -g status-fg white
#set -g status-fg colour13
# set statusline
set -g status-right-length 150

set -g status-right '#{prefix_highlight} #(~/Documents/scripts/tmux_info.sh)'
if-shell -b '[ "$(uname)" = Linux ]' \
  "set -g status-right '#{prefix_highlight} %d-%b-%y %H:%M:%S | # CPU: #{cpu_percentage} | #(~/Documents/scripts/tmux_info.sh)'";

set -g set-clipboard on
set -g history-limit 100000

# in case the environment variable EDITOR or VISUAL does not point to vim
# https://github.com/gpakosz/.tmux/issues/123#issuecomment-351779186
set -g status-keys vi
set -g mode-keys vi

# enable mouse mode to use tpm plugin
set -g mouse on



# --------------
# alter tmux copy-paste behavior
## tmux version < 2.4
bind p paste-buffer
#bind-key -t vi-copy 'v' begin-selection
#bind-key -t vi-copy 'y' copy-selection
#bind-key -t vi-copy 'r' rectangle-toggle


## tmux version >= 2.4
bind-key -T copy-mode-vi v send-keys -X begin-selection
#bind-key -T copy-mode-vi y send-keys -X copy-selection

#bind-key -T copy-mode-vi r send-keys -X rectangle-toggle
bind-key -T copy-mode-vi -n C-v send-keys -X rectangle-toggle  # mimmick vim rectangle selection -> <CTRL>+v

# be sure to have wl-clipboard installed!
bind -T copy-mode-vi y send-keys -X copy-pipe 'wl-copy'  # replaced tmux-yank

# --------------


# from http://endot.org/2011/12/06/my-tmux-configuration/
## vim-like pane resizing
bind -r C-h resize-pane -L
bind -r C-j resize-pane -D
bind -r C-k resize-pane -U
bind -r C-l resize-pane -R

# trigger status line refresh on pane switch
bind -r C-left select-pane  -L\; refresh-client -S
bind -r C-right select-pane -R\; refresh-client -S
bind -r C-up select-pane    -U\; refresh-client -S
bind -r C-down select-pane  -D\; refresh-client -S

## tmux-better-mouse-mode settings
#====================================
# When enabled, tmux will emulate scrolling for "full-screen", alternate buffer programs, such as less, man, or vi that don't themselves already support mouse interactions. It will not enter copy-mode
set -g @emulate-scroll-for-no-mouse-alternate-buffer "on"

set -g @scroll-down-exit-copy-mode "off"
#====================================




## tmux-copycat settings - tmux-copycat stored searches
#====================

# maybe add IPv6 support
set -g @copycat_search_C-i '[[:digit:]]{1,3}\.[[:digit:]]{1,3}\.[[:digit:]]{1,3}\.[[:digit:]]{1,3}' # custom keyboard shortcut for ip search

set -g @copycat_search_h '\b([0-9a-f]{7,40}|[[:alnum:]]{52}|[0-9a-f]{64}|[0-9a-f]{56}|[0-9a-zA-Z+]{68})\b' # custom hash search and keyboard shortcut

set -g @copycat_search_k '[A-Za-z0-9-]+-[a-f0-9]{10}-[a-z0-9]{5}|[A-Za-z0-9-]+-[a-z0-9]{5}' #  search for kubernetes objects

set -g @copycat_search_a '0x[A-Fa-f0-9]{8}|0x[A-Fa-f0-9]{16}|[A-Fa-f0-9]{8}|[A-Fa-f0-9]{16}' # 32 or 64 bit adresses

set -g @copycat_search_i '[[:alnum:]]{12}\\s' # search for docker container id

set -g @copycat_search_C-a '^.+$' # any non-empty line

#====================


## tmux-continuum settings
#=========================

set -g @continuum-restore 'on'

#========================

## tmux-resurrect settings
#=========================

#set -g @resurrect-save-shell-history 'on'

#========================



## INSTALLING PLUGINS
## 1) tmux source ~/.tmux.conf
## 2) Press prefix + I or run $TMUX_PLUGIN_MANAGER_PATH/tpm/scripts/install_plugins.sh to fetch plugins and source them.

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
#set -g @plugin 'tmux-plugins/tmux-sensible'

set -g @plugin 'nhdaly/tmux-better-mouse-mode'

set -g @plugin 'tmux-plugins/tmux-logging'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-open'
#set -g @plugin 'tmux-plugins/tmux-yank'  # manually set yank behavior

set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-resurrect'

set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-cpu'

## examples
# set -g @plugin 'github_username/plugin_name'
# set -g @plugin 'git@github.com/user/plugin'
# set -g @plugin 'git@bitbucket.com/user/plugin'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
# running plugins#
#run-shell ~/.tmux/plugins/tmux-sensible/sensible.tmux
run-shell ~/.tmux/plugins/tmux-better-mouse-mode/scroll_copy_mode.tmux
run-shell ~/.tmux/plugins/tmux-copycat/copycat.tmux
run-shell ~/.tmux/plugins/tmux-copycat/open.tmux
run-shell ~/.tmux/plugins/tmux-logging/logging.tmux
#run-shell ~/.tmux/plugins/tmux-yank/yank.tmux  # manually set yank behavior
run-shell ~/.tmux/plugins/tmux-continuum/continuum.tmux
run-shell ~/.tmux/plugins/tmux-prefix-highlight/prefix_highlight.tmux
run-shell ~/.tmux/plugins/tmux-cpu/cpu.tmux

